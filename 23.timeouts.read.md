# Task #23: timeouts.read

## Summary
The `timeouts.read` field is a Terraform meta-argument that controls the timeout duration for read operations. The default value of 5 minutes has been extracted from the provider source code and is already correctly configured in `variables.tf`.

## Shadow Implementation
No shadow module implementation required - timeouts are handled by the parent module's `azapi_resource` block directly.

```hcl
# variables.tf (already configured correctly)
variable "timeouts" {
  type = object({
    create = optional(string, "30m")
    delete = optional(string, "30m")
    read   = optional(string, "5m")  # <- Task #23: Default from provider
    update = optional(string, "30m")
  })
  default = {
    create = "30m"
    delete = "30m"
    read   = "5m"  # <- Must match type definition
    update = "30m"
  }
  nullable    = false  # <- Required for root-level argument with default
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 30 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 30 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.  # <- Task #23
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 30 minutes.
EOT
}

# migrate_outputs.tf (already exists)
output "timeouts" {
  value = var.timeouts  # <- Passes timeouts to parent module's azapi_resource
}
```

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

From `resourceSubnet()` function:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),  // <- Task #23: Read timeout
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

**Evidence:**
- Default value: **5 minutes** (`5 * time.Minute`)
- This is a resource-level meta-argument, not a request body property
- The `timeouts` block controls Terraform operation timeout durations

**Classification:**
- **Type:** Timeouts block argument (Type 4 - Block Argument, but special handling per timeouts.md)
- **Phase:** N/A (meta-argument, not part of Create/Update API calls)
- **Location:** Parent module's `azapi_resource` block, not in shadow module's `locals`

## Provider Schema

From the provider source code schema definition:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),  // <- Default: 5 minutes
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

**Field Details:**
- **Type:** Time duration (converted to string format in Terraform)
- **Default:** 5 minutes
- **Required:** No (optional with default)
- **ForceNew:** N/A (meta-argument)

## Azure API Schema

**N/A** - The `timeouts` block is not part of the Azure API schema. It is a Terraform provider meta-argument that controls operation timeout behavior at the provider level.

## Mapping

**Provider (Go) → Terraform:**
- `pluginsdk.DefaultTimeout(5 * time.Minute)` → `optional(string, "5m")`
- Duration conversion: Go duration constant → String format (e.g., "5m", "30m")

## Special Handling

### Timeouts Block Handling (per timeouts.md)

1. **No Shadow Module Implementation:**
   - Timeouts are NOT added to `locals.body`, `locals.sensitive_body`, or `locals.replace_triggers_external_values`
   - Shadow module only passes the variable through via output

2. **Variable Configuration (variables.tf):**
   - ✅ Type definition: `read = optional(string, "5m")` - matches provider default
   - ✅ Default block: `read = "5m"` - must match type definition
   - ✅ Nullable: `nullable = false` - required for root-level argument with default
   - ✅ Description: Documents default value (5 minutes)

3. **Output Configuration (migrate_outputs.tf):**
   - ✅ `output "timeouts" { value = var.timeouts }` already exists
   - This allows parent module to pass timeouts directly to `azapi_resource` block

4. **Parent Module Usage:**
   ```hcl
   resource "azapi_resource" "this" {
     # ... other arguments ...
     timeouts {
       create = module.replicator.timeouts.create
       delete = module.replicator.timeouts.delete
       read   = module.replicator.timeouts.read    # <- Task #23
       update = module.replicator.timeouts.update
     }
   }
   ```

## Verification

**Configuration Already Correct:**

All required configuration is already in place:

1. ✅ **Type definition:** `read = optional(string, "5m")` in variables.tf line 136
2. ✅ **Default block:** `read = "5m"` in variables.tf line 141 (matches type definition)
3. ✅ **Nullable:** `nullable = false` in variables.tf line 145
4. ✅ **Description:** "Defaults to 5 minutes" in variables.tf line 149
5. ✅ **Output:** `output "timeouts"` exists in migrate_outputs.tf lines 32-34

**No code changes required** - all configuration matches the provider's default timeout value of 5 minutes.

## Edge Case Analysis

**Null Semantics:**
- Not applicable - `nullable = false` prevents null values
- Default value ensures read timeout is always defined

**Boundary Conditions:**
- Minimum: Terraform accepts any valid duration string (e.g., "1s", "1m")
- Maximum: No hard limit, but excessively long timeouts are impractical
- Default: 5 minutes is appropriate for read operations (non-mutating API calls)

**Idempotency:**
- Timeouts do not affect resource state - they only control operation wait time
- Multiple applies with same timeout value behave identically

**Safe References:**
- Value is passed through as-is from variable to output
- No complex transformations or nested access required

## Checklist

- ✅ Property in correct location (variable + output, no shadow module changes)
- ✅ Default value matches provider schema (5 minutes)
- ✅ Type definition and default block are synchronized
- ✅ Description documents the default value accurately
- ✅ Output exists in migrate_outputs.tf for parent module consumption
- ✅ No shadow module implementation (correct per timeouts.md)
- ✅ Nullable = false set for root-level argument with default
- ✅ Edge Case Analysis completed
- ✅ Proof created
- ✅ track.md will be updated to Pending for check

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2026-01-20
**Task:** #23 - timeouts.read

### Validation Results

✅ **Default Value Extraction:** Correctly identified 5 minutes from provider schema (`pluginsdk.DefaultTimeout(5 * time.Minute)`)
✅ **Type Definition:** `read = optional(string, "5m")` matches provider default
✅ **Default Block Synchronization:** `read = "5m"` in default block matches type definition (CRITICAL requirement from timeouts.md)
✅ **Nullable Constraint:** `nullable = false` explicitly set (prevents null override of default)
✅ **Description Accuracy:** "Defaults to 5 minutes" correctly documents the default value
✅ **Output Configuration:** `output "timeouts"` exists in migrate_outputs.tf (lines 32-34)
✅ **Shadow Module Implementation:** No changes to migrate_main.tf (correct per timeouts.md - meta-argument handled by parent)
✅ **Deferred Work:** No items in following.md for this task
✅ **Proof Document:** All required sections present with provider code evidence

### Compliance Statement

This implementation EXACTLY follows the requirements in `executor.md` and the special handling rules in `timeouts.md`. The executor correctly identified that the timeouts variable configuration was already complete from previous timeout tasks (Tasks #20-22), requiring only verification that the read field default matches the provider schema.

**Key Compliance Points:**
1. Default value (5 minutes) extracted from provider source code ✅
2. Type definition default and variable default block are synchronized ✅
3. Nullable = false prevents users from overriding with null ✅
4. No shadow module implementation (timeouts are meta-arguments) ✅
5. Output exists for parent module consumption ✅

**Status:** APPROVED ✅

---
