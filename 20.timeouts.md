# Task #20 - timeouts Block Structure Skeleton

## Summary

Created the structure skeleton for the `timeouts` block. This is a Terraform provider meta-argument that controls operation timeout durations, not an Azure API property. The block framework has been established with default timeout values extracted from the provider schema. Individual child tasks (#21-24) will handle each timeout field (create, delete, read, update).

## Provider Schema Evidence

From `resourceSubnet()` function in azurerm provider:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

**Default Timeout Values:**
- Create: 30 minutes
- Read: 5 minutes
- Update: 30 minutes
- Delete: 30 minutes

## Implementation

### 1. Updated `variables.tf`

Updated the `timeouts` variable with proper structure and defaults:

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "30m")  # <- Default from provider
    delete = optional(string, "30m")  # <- Default from provider
    read   = optional(string, "5m")   # <- Default from provider
    update = optional(string, "30m")  # <- Default from provider
  })
  default = {
    create = "30m"  # <- Matches type definition
    delete = "30m"  # <- Matches type definition
    read   = "5m"   # <- Matches type definition
    update = "30m"  # <- Matches type definition
  }
  nullable    = false  # <- Required for root-level arguments with defaults
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 30 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 30 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 30 minutes.
EOT
}
```

**Key Implementation Details:**
- Each field in `type` uses `optional(string, "XXm")` with default value
- The `default` block values exactly match the optional() defaults
- Set `nullable = false` as required for root-level arguments with defaults
- Updated descriptions to reflect correct default durations

### 2. Added Output in `migrate_outputs.tf`

Added timeouts output to allow parent module to access the timeout configuration:

```hcl
output "timeouts" {
  value = var.timeouts
}
```

This output enables the parent module to pass the timeouts directly to the `azapi_resource` block's dynamic timeouts block.

## Block Structure Created

The skeleton establishes the complete timeouts block framework:

```hcl
timeouts {
  create = ...  # Task #21
  delete = ...  # Task #22
  read   = ...  # Task #23
  update = ...  # Task #24
}
```

## Shadow Module Implementation

**No changes required** in shadow module (`migrate_main.tf`, `migrate_variables.tf`, etc.):
- The `timeouts` block is a Terraform meta-argument, not part of the Azure API request body
- It's consumed directly by the parent module's `azapi_resource` block
- The variable and output provide the necessary plumbing for the parent module to use

## Child Tasks Ready for Delegation

All child tasks for the `timeouts` block are now ready for implementation:

| Task # | Field | Description |
|--------|-------|-------------|
| #21 | timeouts.create | Create operation timeout (default: 30m) |
| #22 | timeouts.delete | Delete operation timeout (default: 30m) |
| #23 | timeouts.read | Read operation timeout (default: 5m) |
| #24 | timeouts.update | Update operation timeout (default: 30m) |

Each child task only needs to verify the already-configured default value matches the provider schema (which has been done in this task).

## Edge Case Analysis

**Timeouts Block Characteristics:**
- **Meta-argument nature:** Not part of Azure API schema, purely Terraform behavior control
- **Null handling:** Set to `nullable = false` with proper defaults to ensure timeouts are always defined
- **Default synchronization:** Both `type` definition and `default` block have matching values to prevent inconsistencies
- **Parent consumption:** Parent module uses dynamic block to conditionally apply timeouts
- **String format:** Timeout durations use Terraform duration string format (e.g., "30m", "5m")
- **No ForceNew:** Changes to timeout values don't trigger resource replacement
- **No validation needed:** Terraform validates duration string format internally

**Boundary Conditions:**
- Empty timeouts object handled by `nullable = false` + `default` 
- Invalid duration strings caught by Terraform's built-in validation
- No cross-field dependencies within timeouts block
- Parent module handles null vs non-null through dynamic block

## Checklist

- ✅ Block structure skeleton created in `variables.tf`
- ✅ Default timeout values extracted from provider schema
- ✅ Type definition with `optional(string, "XXm")` syntax
- ✅ Default block values match type definition defaults
- ✅ Set `nullable = false` for root-level argument
- ✅ Updated descriptions with correct default durations
- ✅ Added `output "timeouts"` to `migrate_outputs.tf`
- ✅ No shadow module changes required (meta-argument)
- ✅ Documented provider schema evidence
- ✅ Listed all child tasks ready for delegation
- ✅ Edge case analysis completed
- ✅ Proof document created
- ✅ Self-review: Only timeouts block structure implemented, no individual field logic

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2026-01-20
**Task:** #20 - timeouts

### Validation Results

✅ **Timeouts Override Document:** Correctly followed `timeouts.md` override rules per executor.md lines 36-38
✅ **Type/Default Synchronization:** All four fields have matching values between `optional(string, "XXm")` and `default` block (CRITICAL requirement from timeouts.md lines 47-51)
✅ **nullable = false:** Correctly set as required for root-level arguments with defaults (executor.md line 405)
✅ **Variable Structure:** Proper use of `optional(string, "default")` syntax for nested defaults
✅ **Output Configuration:** `output "timeouts"` exists in migrate_outputs.tf (required by timeouts.md lines 92-98)
✅ **Provider Schema Evidence:** Correct extraction of default timeout values (Create: 30m, Read: 5m, Update: 30m, Delete: 30m)
✅ **Shadow Module:** No changes to migrate_main.tf (correct - timeouts is meta-argument)
✅ **Deferred Work Completion:** No deferred work for Task #20 in following.md
✅ **Deferred Work Recording:** No deferrals made (appropriate for skeleton task)
✅ **Edge Cases:** Proper analysis of meta-argument nature and null handling
✅ **Proof Document:** No forbidden phrases, follows exact replication principle

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md` and follows all special rules in `timeouts.md`. The critical synchronization between type definition defaults and default block values is perfect. The `nullable = false` requirement is met. No deviations found.

**Status:** APPROVED ✅

---
