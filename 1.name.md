# Task #1 - name - COMPLETED

## Summary
Implemented the `name` argument as the first executor task, creating all initial Shadow Module files (migrate_main.tf, migrate_variables.tf, migrate_outputs.tf, migrate_validation.tf) with complete `azapi_header` structure including `type`, `name`, `location`, `parent_id`, `tags`, `ignore_null_property`, and `retry`.

## Shadow Implementation
```hcl
# migrate_main.tf
locals {
  azapi_header = {
    type                 = "Microsoft.Network/virtualNetworks/subnets@2025-01-01" # <-
    name                 = var.name                                               # <-
    location             = null                                                   # <-
    parent_id            = null                                                   # <-
    tags                 = null                                                   # <-
    ignore_null_property = true                                                   # <-
    retry                = null                                                   # <-
  }

  replace_triggers_external_values = {
    name = { value = var.name } # <-
  }

  body = {
    properties = {}
  }

  sensitive_body = {
    properties = {}
  }

  sensitive_body_version = {}

  locks = []
}
```

## Create Phase Verification

**Query:** `query_terraform_block_implementation_source_code(block_type="resource", terraform_type="azurerm_subnet", entrypoint_name="create")`

**Pattern:** Single-phase - One `CreateOrUpdateThenPoll` operation

**Go Code Evidence:**
```go
func resourceSubnetCreate(d *pluginsdk.ResourceData, meta interface{}) error {
    // ...
    id := commonids.NewSubnetID(subscriptionId, d.Get("resource_group_name").(string), d.Get("virtual_network_name").(string), d.Get("name").(string))
    // ...
    subnet := subnets.Subnet{
        Name:       pointer.To(id.SubnetName),
        Properties: &properties,
    }

    if err := client.CreateOrUpdateThenPoll(ctx, id, subnet); err != nil {
        return fmt.Errorf("creating %s: %+v", id, err)
    }
    // ...
}
```

**Decision:** The `name` field is used during primary Create phase in the main `CreateOrUpdateThenPoll` operation. It's assigned to the `Subnet.Name` field directly in the subnet struct (not in Properties).

## Assignment Path Verification

**Predicted Path:** Root-level `name` in Azure API (not inside `properties`)

**Go Code Evidence:**
```go
subnet := subnets.Subnet{
    Name:       pointer.To(id.SubnetName),  // <- Direct assignment to Subnet.Name
    Properties: &properties,
}
```

**Verified Path:** Root-level `name` field

**Path Comparison:** ✅ MATCH - The `name` is assigned directly to the `Subnet` struct at root level, not inside `Properties`. This confirms it should be placed in `azapi_header.name`, not in `body`.

## Provider Schema

**Source:** `query_terraform_block_implementation_source_code(entrypoint_name="schema")`

```go
"name": {
    Type:     pluginsdk.TypeString,
    Required: true,
    ForceNew: true,
},
```

**Analysis:**
- **Type:** String
- **Required:** Yes (nullable = false in variables.tf)
- **ForceNew:** Yes - Changes force new resource creation
- **Validation:** None specified in schema

## Azure API Schema

**Resource Type:** `Microsoft.Network/virtualNetworks/subnets@2024-07-01`

**API Structure:** Name is a root-level property, not inside `body.properties`

```
Object(map[string]Type{
  "name": String,
  "body": ObjectWithOptionalAttrs(map[string]Type{
    "properties": ...
  })
})
```

## Hidden Fields

None identified for the `name` field. Hidden fields will be checked in Task #11 (`__check_root_hidden_fields__`).

## Mapping

- **Provider:** `name` (snake_case)
- **Azure API:** `name` (already camelCase)
- **Implementation:** Direct mapping, no transformation needed

## Special Handling

### ForceNew Implementation

**Evidence:** Schema shows `ForceNew: true`

**Implementation:**
```hcl
replace_triggers_external_values = {
  name = { value = var.name }  # Stable key, tracks full value
}
```

**Rationale:** Since `name` is marked `ForceNew: true` in the provider schema, any change to the name value must trigger resource replacement. Using Mode 1 (Direct Value Tracking) with stable key wrapping ensures the key is always present and value changes trigger replacement.

### Validations

**Provider Schema:** No custom validations defined (StringIsNotEmpty or other validators not present)

**Action:** No validation block needed in variables.tf. The existing variable definition with `nullable = false` is sufficient.

### Initial Files Created

As the first executor task, created:
1. ✅ `terraform.tf` - Already exists with proper azapi provider configuration
2. ✅ `migrate_main.tf` - Complete locals structure with azapi_header
3. ✅ `migrate_variables.tf` - Template for new variables
4. ✅ `migrate_outputs.tf` - All required outputs
5. ✅ `migrate_validation.tf` - Template for runtime validations

## Deferred Work Completion

No items in `following.md` defer work to this task (file doesn't exist yet as this is Task #1).

## Edge Case Analysis

### Null Semantics
- **Meaning:** N/A - `name` is Required (nullable = false)
- **Handling:** Variable enforces non-null with `nullable = false`

### Boundary Conditions
- **Empty string:** Not explicitly validated in provider schema, relies on Azure API validation
- **Special characters:** Not validated in provider, Azure API will enforce naming rules
- **Length limits:** Not validated in provider, Azure API will enforce

### Idempotency
- ✅ Simple string value, inherently idempotent
- ✅ No order-dependent operations

### Safe References
- ✅ Direct reference to `var.name` (no nested access)
- ✅ Value always present (Required field)

### Resource Type
According to track.md and provider source code:
- API Version: 2025-01-01 (from provider import: `github.com/hashicorp/go-azure-sdk/resource-manager/network/2025-01-01/subnets`)
- Resource Type: `Microsoft.Network/virtualNetworks/subnets`

### Parent Resource
Subnets are child resources of Virtual Networks. The `parent_id` will be populated by Task #3 (virtual_network_name) to construct the proper parent Virtual Network resource ID.

### Location
Subnets inherit location from their parent Virtual Network, so `location` in `azapi_header` is set to `null`.

### Tags
According to the Azure API schema and provider code, subnets do not support tags at the subnet level. Tags are inherited from the Virtual Network. Therefore, `tags` in `azapi_header` is set to `null`.

## Checklist

- ✅ Property in correct local (`azapi_header.name`)
- ✅ ForceNew wrapped: `{ value = var.name }`
- ✅ ALL logic EXACTLY replicated from provider (no shortcuts, no "safer" alternatives)
- ✅ Validations IMPLEMENTED in variables.tf (none required beyond existing nullable = false)
- ✅ TODO comment added to original field in variables.tf (N/A - not a sensitive field)
- ✅ Hidden fields checked (deferred to Task #11)
- ✅ Deferred work in following.md: N/A (no work deferred to other tasks)
- ✅ Deferred work from following.md: N/A (no work deferred to this task)
- ✅ Critical review (null, edge, idempotent, safe refs)
- ✅ Edge Case Analysis in proof
- ✅ Proof created
- ✅ `track.md` ready to update to Pending for check
- ✅ Self-Review: Added ONLY name field implementation and initial file structure
- ✅ Initial Shadow Module files created (migrate_main.tf, migrate_variables.tf, migrate_outputs.tf, migrate_validation.tf)
- ✅ Complete azapi_header structure with all required fields

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent  
**Date:** 2026-01-20  
**Task:** #1 - name

### Validation Results

✅ **ForceNew Logic:** Schema-based ForceNew correctly implemented with Mode 1 (Direct Value Tracking) - stable key wrapping `{ value = var.name }`

✅ **Stable Keys:** Key `name` in `replace_triggers_external_values` is stable (always present)

✅ **Phase Detection:** Field correctly placed in `azapi_header.name` (not in body, as it's a root Azure API field)

✅ **Type Conversion:** Direct string mapping, no conversion needed

✅ **Null Handling:** Correctly enforced via `nullable = false` in existing variable definition

✅ **Validations:** None required beyond nullable constraint - executor correctly determined no custom validations in provider schema

✅ **Deferred Work Completion:** No deferred work for this task (first task, following.md doesn't exist yet)

✅ **Deferred Work Recording:** No deferrals made by this task

✅ **Edge Cases:** Properly analyzed - null prevention via nullable = false, empty string/special characters deferred to Azure API validation per provider behavior

✅ **Initial Files:** All required migrate_* files created with correct structure per executor.md templates

✅ **Resource Type:** Correctly identified `Microsoft.Network/virtualNetworks/subnets@2025-01-01` from track.md

✅ **terraform.tf:** File already existed with appropriate azapi provider configuration (version ~> 2.4 is compatible with required ~> 2.0)

✅ **Assignment Path Verification:** Proof document correctly traced that `name` is assigned to `Subnet.Name` (root level), not to `Properties`, justifying placement in `azapi_header.name`

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md`. The `name` field is:
- Correctly placed in `azapi_header.name` (root-level Azure API field)
- Properly tracked in `replace_triggers_external_values` with stable key wrapping
- Enforced as non-nullable via existing variable definition
- Has no custom validations per provider schema

All initial Shadow Module files (migrate_main.tf, migrate_variables.tf, migrate_outputs.tf, migrate_validation.tf) are properly structured per executor.md templates.

**Note:** Pre-existing duplicate variable definitions in variables.tf are outside the scope of this task and not caused by the executor.

**Status:** APPROVED ✅

---
