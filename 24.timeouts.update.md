# Task #24: timeouts.update

## Summary

The `timeouts.update` field is a Terraform provider meta-argument that controls the timeout duration for update operations. The provider default is 30 minutes. This value is already correctly configured in `variables.tf` with synchronized `type` definition and `default` block. No shadow module implementation is required as timeouts are consumed directly by the parent module's `azapi_resource` block.

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

The `timeouts` block is a Terraform provider meta-argument, not an Azure API property. It does not appear in Create/Read/Update/Delete methods but is defined at the resource level.

From `resourceSubnet()`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
}
```

**Evidence:**
- Default value for `Update`: **30 minutes**
- This is a resource-level meta-argument that controls operation timeout duration
- Not sent to Azure API; handled by Terraform provider

## Provider Schema

From `resourceSubnet()` in `github.com/hashicorp/terraform-provider-azurerm/internal/services/network`:

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),  // <- Update timeout
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
}
```

**Key Details:**
- **Field:** `Update` in `Timeouts` block
- **Type:** Duration
- **Default:** 30 minutes (`30 * time.Minute`)
- **Optional:** Yes (all timeout fields are optional)

## Azure API Schema

N/A - Timeouts are not Azure API properties. They are Terraform provider meta-arguments that control operation timeout behavior.

## Implementation

### Variable Configuration (variables.tf)

The `timeouts` variable is already correctly configured:

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "30m")  # <- Matches default block
    delete = optional(string, "30m")  # <- Matches default block
    read   = optional(string, "5m")   # <- Matches default block
    update = optional(string, "30m")  # <- Matches default block: ✅ CORRECT
  })
  default = {
    create = "30m"  # <- Synced with type definition
    delete = "30m"  # <- Synced with type definition
    read   = "5m"   # <- Synced with type definition
    update = "30m"  # <- Synced with type definition: ✅ CORRECT
  }
  nullable    = false  # <- Required: prevents null values
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 30 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 30 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 30 minutes.  # <- ✅ CORRECT
EOT
}
```

**Verification:**
- ✅ Type definition: `optional(string, "30m")` matches provider default (30 minutes)
- ✅ Default block: `update = "30m"` matches type definition
- ✅ Description: Correctly states "Defaults to 30 minutes"
- ✅ `nullable = false` is set to prevent null values

### Output Configuration (migrate_outputs.tf)

The output already exists and correctly passes the timeouts variable to the parent module:

```hcl
output "timeouts" {
  value = var.timeouts
}
```

This allows the parent module to consume the timeouts value directly in its `azapi_resource` block.

### Shadow Module Implementation

**NO CHANGES REQUIRED** - Per `timeouts.md`, timeouts are NOT implemented in the shadow module's `migrate_*` files. They are consumed directly by the parent module's `azapi_resource` block:

```hcl
# Parent module usage (not part of this task):
resource "azapi_resource" "this" {
  type = local.azapi_header.type
  name = local.azapi_header.name
  # ...
  timeouts {
    create = module.shadow.timeouts.create
    delete = module.shadow.timeouts.delete
    read   = module.shadow.timeouts.read
    update = module.shadow.timeouts.update
  }
}
```

## Mapping

Provider field → Variable field:
- `Timeouts.Update` (30 * time.Minute) → `timeouts.update` ("30m")

## Special Handling

### Meta-Argument Pattern

Timeouts follow a special implementation pattern:
1. **NOT in Azure API request body** - Pure Terraform provider behavior
2. **NOT in shadow module locals** - No `local.body` or `local.sensitive_body` entry
3. **Variable only** - Defined in `variables.tf` with correct defaults
4. **Output for parent** - Exposed via `migrate_outputs.tf` for parent module consumption

### Duration Conversion

Go duration format → Terraform string format:
- `30 * time.Minute` → `"30m"`

### Synchronization Requirements

Per `timeouts.md`, CRITICAL synchronization rules:
1. ✅ `type` definition default MUST match `default` block value
2. ✅ `nullable = false` MUST be set
3. ✅ `description` MUST reflect correct default duration

All requirements are satisfied in the current implementation.

## Edge Case Analysis

**Null Semantics:**
- The `timeouts` variable has `nullable = false`, preventing null values
- Each field uses `optional(string, "30m")`, ensuring a default is always available
- Users can override the default by providing a custom value

**Boundary Conditions:**
- Minimum timeout: Terraform accepts any valid duration string (e.g., "1s")
- Maximum timeout: Terraform accepts large durations (e.g., "24h")
- Invalid format: Terraform's duration parser validates the string format

**Idempotency:**
- Timeouts don't affect resource state or API calls
- Changing timeout values doesn't trigger resource replacement
- Same timeout value always produces same behavior

**Safe References:**
- The output references `var.timeouts.update` directly
- No null checks needed due to `nullable = false` and default values
- Parent module receives a guaranteed non-null object with all fields populated

## Checklist

- ✅ Property in correct location (variables.tf only - not in locals)
- ✅ Variable `type` definition matches provider default (30m)
- ✅ Variable `default` block synchronized with type definition
- ✅ Variable `description` correctly states "Defaults to 30 minutes"
- ✅ Variable has `nullable = false` set
- ✅ Output exists in migrate_outputs.tf
- ✅ No shadow module implementation (per timeouts.md instructions)
- ✅ ForceNew not applicable (timeouts don't trigger replacement)
- ✅ Hidden fields not applicable (meta-argument)
- ✅ Deferred work: No items in following.md for this task
- ✅ Critical review completed
- ✅ Edge Case Analysis documented
- ✅ Proof document created
- ✅ track.md ready for status update to "Pending for check"
- ✅ Self-Review: Implementation exactly matches provider behavior - default value of 30 minutes correctly replicated

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2026-01-20
**Task:** #24 - timeouts.update

### Validation Results

✅ **Variable Type Definition:** Correct - `optional(string, "30m")` matches provider default (30 minutes)
✅ **Variable Default Block:** Correct - `update = "30m"` matches type definition default
✅ **Nullable:** Correct - `nullable = false` explicitly set to prevent null values
✅ **Description:** Correct - States "Defaults to 30 minutes" matching provider default
✅ **Output:** Correct - `output "timeouts"` exists in migrate_outputs.tf
✅ **Synchronization:** Perfect sync between type definition, default block, and description
✅ **Shadow Module:** Correct - No implementation in migrate_main.tf locals (per timeouts.md)
✅ **Provider Evidence:** Correct - Proof shows Go code `Update: pluginsdk.DefaultTimeout(30 * time.Minute)`
✅ **Duration Conversion:** Correct - `30 * time.Minute` → `"30m"`
✅ **Deferred Work Completion:** No deferred work for this task in following.md
✅ **Deferred Work Recording:** No deferrals made by this task
✅ **Proof Document:** All required sections present, no forbidden content

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md` and `timeouts.md`. The timeout meta-argument is correctly configured with:
- Provider default value of 30 minutes correctly replicated
- Perfect synchronization between type definition and default block
- Proper nullable protection
- Output configured for parent module consumption
- No shadow module implementation (correct per timeouts.md)

No deviations, simplifications, or "safer alternatives" were found. All critical synchronization requirements from timeouts.md (lines 47-50) are satisfied.

**Status:** APPROVED ✅

---
