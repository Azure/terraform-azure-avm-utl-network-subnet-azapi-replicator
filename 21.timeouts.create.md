# Task #21 - timeouts.create

## Summary

Verified the `create` timeout field within the `timeouts` block. The default value (30 minutes) has already been correctly configured in Task #20 and matches the provider schema exactly.

## Provider Schema Evidence

From `resourceSubnet()` function in azurerm provider (schema query):

```go
Timeouts: &pluginsdk.ResourceTimeout{
    Create: pluginsdk.DefaultTimeout(30 * time.Minute),
    Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
    Update: pluginsdk.DefaultTimeout(30 * time.Minute),
    Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
},
```

**Evidence:**
- Field: `Create`
- Default value: **30 minutes** (`30 * time.Minute`)
- This is a resource-level meta-argument, not a request body property

## Create Phase Verification

**Pattern:** Meta-argument (N/A for Azure API)

The `timeouts` block is a Terraform provider meta-argument that controls how long operations wait before timing out. It's not part of the Azure REST API request/response and therefore:
- Not included in `local.body` or `local.sensitive_body`
- Not sent to Azure API
- Handled directly by the parent module's `azapi_resource` block

## Implementation Verification

The implementation was completed in Task #20. Verified current state in `variables.tf`:

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "30m")  # <- Verified: matches provider default
    delete = optional(string, "30m")
    read   = optional(string, "5m")
    update = optional(string, "30m")
  })
  default = {
    create = "30m"  # <- Verified: matches type definition
    delete = "30m"
    read   = "5m"
    update = "30m"
  }
  nullable    = false
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 30 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 30 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 30 minutes.
EOT
}
```

**Verification Results:**
- ✅ Type definition: `optional(string, "30m")` - correct
- ✅ Default block value: `create = "30m"` - matches type definition
- ✅ Description: "Defaults to 30 minutes" - correct
- ✅ Conversion: `30 * time.Minute` → `"30m"` - correct string format

## Shadow Module Implementation

**No changes required** in shadow module files:
- `migrate_main.tf` - No changes (timeouts not in body)
- `migrate_variables.tf` - No changes (no new variables needed)
- `migrate_outputs.tf` - Already has `output "timeouts"` (added in Task #20)
- `migrate_validation.tf` - No changes (Terraform validates duration format)

The `timeouts` value is consumed by the parent module's `azapi_resource` block through the output.

## Mapping

**Terraform:** `timeouts.create` (string duration)  
**Provider Schema:** `Timeouts.Create` (time.Duration)  
**Azure API:** N/A (meta-argument, not sent to API)

## Special Handling

**Meta-Argument Characteristics:**
- Not a ForceNew field (timeout changes don't recreate resources)
- Not a Sensitive field (timeout values are not sensitive)
- No validation needed in variables.tf (Terraform validates duration strings internally)
- No cross-field dependencies with other timeouts fields

**Format Conversion:**
- Provider: `pluginsdk.DefaultTimeout(30 * time.Minute)` (Go duration)
- Terraform: `"30m"` (string duration format)
- Terraform accepts: "30m", "1h", "90s", etc.

## Deferred Work Completion

Checked `following.md`: No work deferred to Task #21.

## Edge Case Analysis

**Timeout-Specific Edge Cases:**
1. **Null handling:** Variable has `nullable = false` with `default` block, ensuring timeout is always defined
2. **String format:** Terraform's built-in duration parser handles validation (e.g., "30m", "1h30m", "1800s" all valid)
3. **Invalid values:** Terraform returns error before reaching azapi_resource if duration string is malformed
4. **Zero/negative:** Terraform validates positive durations
5. **Very large values:** No practical upper limit, Azure API has its own service-side timeouts
6. **Idempotency:** Timeout changes don't affect resource state or trigger replacements

**Parent Module Consumption:**
The parent module uses the timeout value through the output:
```hcl
module "subnet" {
  source = "./replicator"
  # ... other inputs
}

resource "azapi_resource" "this" {
  # ... other fields
  timeouts {
    create = module.subnet.timeouts.create
    # ... other timeout fields
  }
}
```

## Checklist

- ✅ Provider schema queried and default timeout extracted (30 minutes)
- ✅ Variable implementation verified in variables.tf (matches provider)
- ✅ Type/default synchronization verified (both "30m")
- ✅ Description verified (correct default mentioned)
- ✅ No shadow module changes needed (meta-argument)
- ✅ Output "timeouts" exists in migrate_outputs.tf (verified)
- ✅ Deferred work checked in following.md (none found)
- ✅ Edge case analysis completed (null handling, format validation)
- ✅ Proof document created without forbidden phrases
- ✅ Implementation exactly matches provider behavior
- ✅ track.md will be updated to Pending for check

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2026-01-20
**Task:** #21 - timeouts.create

### Validation Results

✅ **Provider Schema Match:** Default timeout of 30 minutes correctly replicated from `pluginsdk.DefaultTimeout(30 * time.Minute)`
✅ **Type Definition:** `optional(string, "30m")` correctly implements default at type level
✅ **Default Block:** `create = "30m"` correctly matches type definition (double-default pattern)
✅ **Nullable Constraint:** `nullable = false` correctly set (MANDATORY per executor.md for root-level arguments with defaults)
✅ **Description:** Correctly documents "Defaults to 30 minutes"
✅ **Meta-Argument Handling:** Correctly NOT included in `local.body` (timeouts are Terraform meta-arguments, not Azure API fields)
✅ **Output:** `output "timeouts"` exists in `migrate_outputs.tf` for parent module consumption
✅ **Phase Detection:** N/A - meta-argument, not sent to Azure API
✅ **Deferred Work Completion:** No deferred work for this task in following.md
✅ **Edge Cases:** Null handling correct (nullable=false with default), Terraform validates duration format
✅ **Implementation Placement:** Correctly implemented in Task #20 (parent timeouts block), Task #21 verifies the create field

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md`:
- Default value matches provider schema exactly (30 minutes)
- Both type-level default (`optional(string, "30m")`) and variable-level default block are synchronized
- `nullable = false` correctly prevents null override of default (executor.md line 404-434 requirement)
- Timeouts are meta-arguments handled by azapi_resource, not sent to Azure API
- No code changes needed in migrate_* files per executor.md timeout handling rules

**Status:** APPROVED ✅

---
